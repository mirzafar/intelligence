<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>AI –ß–∞—Ç</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

    <style>
        body {
            background: linear-gradient(135deg, #d9f7ff, #eaf3ff, #ffffff);
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 1rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* Offcanvas */
        .offcanvas {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 75%;
            max-width: 280px;
            background: #fff;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.25);
            transition: transform 0.3s ease-in-out;
            z-index: 50;
        }

        .offcanvas-left {
            left: 0;
            transform: translateX(-100%);
        }

        .offcanvas-right {
            right: 0;
            transform: translateX(100%);
        }

        .offcanvas.show {
            transform: translateX(0);
        }

        .chat-box-h {
            max-height: calc(100vh - 140px);
        }

    </style>
</head>
<body class="min-h-screen flex flex-col p-2 md:p-4">

<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–±–∏–ª–∫–∏ -->
<header class="flex items-center justify-between bg-white/70 backdrop-blur p-3 rounded-lg mb-2 shadow md:hidden">
    <button id="menu-left" class="text-emerald-600 text-xl"><i class="fas fa-bars"></i></button>
    <h1 class="font-bold text-gray-700">AI –ß–∞—Ç</h1>
    <button id="menu-right" class="text-emerald-600 text-xl"><i class="fas fa-folder"></i></button>
</header>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<div class="glass w-full flex-1 flex overflow-hidden">

    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (desktop) -->
    <aside id="left-sidebar"
           class="hidden md:flex w-1/4 bg-white/60 backdrop-blur p-4 border-r overflow-y-auto scrollbar-thin flex-col">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-sm font-semibold">–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤</h2>
            <button id="new-chat" class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">+
                –ù–æ–≤—ã–π
            </button>
        </div>
        <ul id="chat-list" class="space-y-2 text-sm text-gray-700"></ul>
    </aside>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
    <main class="flex-1 flex flex-col">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="chat-box" class="flex-1 overflow-y-auto px-4 md:px-6 py-4 space-y-3 scrollbar-thin chat-box-h">
            <div class="text-gray-400 text-sm text-center">‚ú® –ù–æ–≤—ã–π —á–∞—Ç</div>
        </div>

        <!-- –í–≤–æ–¥ -->
        <div class="border-t p-3 bg-white/80 backdrop-blur">
            <div class="flex items-end gap-2">
        <textarea id="prompt-input" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                  class="flex-1 resize-none bg-gray-100 p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 text-sm"></textarea>
                <button id="send-btn"
                        class="bg-cyan-400 px-4 py-2 rounded-lg text-sm shadow">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (desktop) -->
    <aside id="right-sidebar"
           class="hidden lg:flex w-[220px] bg-white/60 backdrop-blur p-4 border-l scrollbar-thin overflow-y-auto flex-col">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-sm font-semibold">–§–∞–π–ª—ã</h2>
        </div>
        <div id="files-list" class="space-y-2 text-sm text-gray-700"></div>
        <div class="mt-3">
            <input type="file" id="file-upload-input" multiple hidden/>
            <button id="upload-file-btn"
                    class="w-full text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">
                <i class="fas fa-plus mr-1 text-[10px]"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
        </div>
    </aside>
</div>

<!-- Offcanvas —Å–ª–µ–≤–∞ -->
<div id="offcanvas-left" class="offcanvas offcanvas-left">
    <div class="p-4 border-b flex justify-between items-center">
        <h2 class="text-sm font-semibold">–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤</h2>
        <button id="close-left"><i class="fas fa-times"></i></button>
    </div>
    <ul id="chat-list-mobile" class="p-4 space-y-2 text-sm text-gray-700"></ul>
</div>

<!-- Offcanvas —Å–ø—Ä–∞–≤–∞ -->
<div id="offcanvas-right" class="offcanvas offcanvas-right">
    <div class="p-4 border-b flex justify-between items-center">
        <h2 class="text-sm font-semibold">–§–∞–π–ª—ã</h2>
        <button id="close-right"><i class="fas fa-times"></i></button>
    </div>
    <div id="files-list-mobile" class="p-4 space-y-2 text-sm text-gray-700"></div>
</div>

<!-- –õ–æ–∞–¥–µ—Ä -->
<div id="loader" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center space-y-4">
        <svg class="animate-spin h-10 w-10 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
        </svg>
        <span id="loader-text" class="text-gray-700 font-medium text-sm">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
</div>

<div id="redirect-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-lg w-80">
        <input id="redirect-filename"
               type="text"
               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞..."
               class="w-full border p-2 rounded mb-4 focus:ring-2 focus:ring-emerald-400"/>
        <div class="flex justify-end gap-2">
            <button onclick="closeRedirectModal()"
                    class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm">
                –û—Ç–º–µ–Ω–∞
            </button>
            <button onclick="confirmRedirect()"
                    class="px-3 py-1 rounded bg-green-500 hover:bg-green-600 text-white text-sm">
                –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
            </button>
        </div>
    </div>
</div>


<script>
    // Offcanvas toggle
    $('#menu-left').click(() => $('#offcanvas-left').addClass('show'));
    $('#close-left, #chat-box').click(() => $('#offcanvas-left').removeClass('show'));

    $('#menu-right').click(() => $('#offcanvas-right').addClass('show'));
    $('#close-right, #chat-box').click(() => $('#offcanvas-right').removeClass('show'));


    // –ü—Ä–∏–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –∏ —á–∞—Ç–æ–≤ –º–µ–∂–¥—É desktop –∏ mobile
    function syncLists() {
        $('#chat-list-mobile').html($('#chat-list').html());
        $('#files-list-mobile').html($('#files-list').html());
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
    setInterval(syncLists, 1000);

    let currentChatId = null;
    let availableFiles = [];

    function showLoader(text = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
        $('#loader-text').text(text);
        $('#loader').removeClass('hidden');
    }

    function hideLoader() {
        $('#loader').addClass('hidden');
    }

    function generateUUID() {
        return crypto.randomUUID();
    }

    function appendMessage(role, text, messageId = null) {
        const box = $('#chat-box');
        const id = messageId || 'msg-' + Date.now();

        const isUser = role === 'user';

        const bubbleClass = isUser
            ? 'bg-green-100 text-gray-900 self-end'
            : 'bg-gray-100 text-gray-800 self-start';

        const avatar = isUser
            ? '<div class="mx-2 w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center text-lg"><i class="fas fa-user"></i></div>'
            : '<div class="mx-2 w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center text-lg"><i class="fas fa-robot"></i></div>';


        // –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞)
        let redirectBtn = '';
        if (!isUser) {
            redirectBtn = `
      <button onclick="openRedirectModal('${id}')"
              class="absolute top-1 right-2 text-gray-400 hover:text-emerald-600 transition">
        <i class="fas fa-share"></i>
      </button>
    `;
        }

        const bubble = `
      <div class="flex ${isUser ? 'justify-end' : 'justify-start'} w-full my-2 relative">
        ${!isUser ? avatar : ''}
        <div id="${id}"
             class="relative group max-w-[75%] px-3 rounded-lg ${bubbleClass} text-sm whitespace-pre-wrap"
             ${!isUser ? 'ondblclick="editMessage(\'' + id + '\')"' : ''}>
          <div class="msg-text">${$('<div>').text(text).html()}</div>
          ${redirectBtn}
        </div>
        ${isUser ? avatar : ''}
      </div>
    `;

        box.append(bubble);
        box.scrollTop(box[0].scrollHeight);
    }


    function editMessage(id) {
        const el = $('#' + id).find('.msg-text');
        el.attr('contenteditable', 'true')
            .addClass('outline-none border border-emerald-400 rounded-md p-2 bg-white')
            .focus();

        // –∫—É—Ä—Å–æ—Ä –≤ –∫–æ–Ω–µ—Ü
        const range = document.createRange();
        const sel = window.getSelection();
        range.selectNodeContents(el[0]);
        range.collapse(false);
        sel.removeAllRanges();
        sel.addRange(range);

        // –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ ‚Üí –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        el.off('blur').on('blur', function () {
            saveMessage(id);
        });

    }


    function saveMessage(id) {
        const el = $('#' + id).find('.msg-text');
        const newText = el.text().trim();

        el.removeAttr('contenteditable')
            .removeClass('border border-emerald-400 rounded-md p-2 bg-white');

        fetch(`/api/chats/${currentChatId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({messageId: id, text: newText})
        })
            .then(r => r.json())
            .then(res => {
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ', res);
                const note = $(`<div class="text-emerald-500 text-xs mt-1">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ</div>`);
                $('#' + id).append(note);
                setTimeout(() => note.fadeOut(300, () => note.remove()), 1500);
            })
            .catch(err => {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + err.message);
            });
    }

    function redirectMessage(id, filename) {
        const el = $('#' + id).find('.msg-text');
        const text = el.text().trim();
        showLoader();

        fetch(`/api/chats/${currentChatId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                messageId: id,
                action: 'redirect',
                text,
                filename
            })
        })
            .then(r => r.json())
            .then(res => {
                console.log('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ', res);
                const note = $(`<div class="text-blue-500 text-xs mt-1">–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ ¬´${filename}¬ª üîÅ</div>`);
                $('#' + id).append(note);
                setTimeout(() => note.fadeOut(300, () => note.remove()), 2000);
                hideLoader();
                loadFiles();
            })
            .catch(err => {
                alert('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ' + err.message);
                hideLoader();
            });
    }


    function loadChatHistory() {
        showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...');
        $.getJSON('/api/chats', function (data) {
            const chatList = $('#chat-list');
            chatList.empty();

            const items = data.items;
            if (items.length === 0) {
                chatList.append('<li class="text-gray-500 text-center py-1 text-xs">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤</li>');
            } else {
                items.forEach(chat => {
                    chatList.append(`
                        <li class="group flex items-center justify-between hover:bg-gray-100 rounded">
                            <button class="flex-1 text-left px-1.5 py-0.5 truncate text-xs" onclick="viewChat('${chat._id}')">
                                ${$('<div>').text(chat.title.substring(0, 25) + (chat.title.length > 25 ? '...' : '')).html()}
                            </button>
                            <button
                                class="delete-btn p-0.5 text-gray-400 hover:text-red-500 group-hover:visible"
                                onclick="deleteChat('${chat._id}', this)"
                            >
                                <i class="fas fa-trash-alt text-[10px]"></i>
                            </button>
                        </li>
                    `);
                });
            }
            hideLoader();
        }).fail(() => {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            hideLoader();
        });
    }

    function loadFiles() {
        showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...');
        $.getJSON('/api/files', function (data) {
            const filesList = $('#files-list');
            filesList.empty();
            availableFiles = data.items || [];

            if (availableFiles.length === 0) {
                filesList.append('<div class="text-gray-500 text-center py-1 text-xs">–ù–µ—Ç —Ñ–∞–π–ª–æ–≤</div>');
            } else {
                availableFiles.forEach(file => {
                    filesList.append(`
                        <div class="file-item flex items-center justify-between p-1.5 bg-white rounded border text-xs">
                            <a target="_blank" href="/api/files/${file._id}/download" class="truncate flex-1 text-emerald-600 hover:underline">
                                ${$('<div>').text(file.title.substring(0, 20) + (file.title.length > 20 ? '...' : '')).html()}
                            </a>
                            <div class="flex space-x-1">
                                <button onclick="deleteFile('${file._id}', this)" class="text-gray-500 hover:text-red-500 p-0.5">
                                    <i class="fas fa-trash-alt text-[10px]"></i>
                                </button>
                            </div>
                        </div>
                    `);
                });
            }
            hideLoader();
        }).fail(() => {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤');
            hideLoader();
        });
    }

    function deleteFile(fileId, button) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?')) return;

        $(button).prop('disabled', true).html('<i class="fas fa-spinner fa-spin text-[10px]"></i>');

        $.ajax({
            url: `/api/files/${fileId}`,
            type: 'DELETE',
            success: function (response) {
                if (response._success) {
                    loadFiles();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (response.message || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª'));
                    $(button).prop('disabled', false).html('<i class="fas fa-trash-alt text-[10px]"></i>');
                }
            },
            error: function () {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                $(button).prop('disabled', false).html('<i class="fas fa-trash-alt text-[10px]"></i>');
            }
        });
    }

    function deleteChat(chatId, button) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç?')) return;

        $(button).prop('disabled', true).html('<i class="fas fa-spinner fa-spin text-[10px]"></i>');

        $.ajax({
            url: `/api/chats/${chatId}`,
            type: 'DELETE',
            success: function (response) {
                if (response._success) {
                    if (currentChatId === chatId) {
                        $('#new-chat').click();
                    }
                    loadChatHistory();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (response.message || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —á–∞—Ç'));
                    $(button).prop('disabled', false).html('<i class="fas fa-trash-alt text-[10px]"></i>');
                }
            },
            error: function () {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                $(button).prop('disabled', false).html('<i class="fas fa-trash-alt text-[10px]"></i>');
            }
        });
    }

    function viewChat(chatId) {
        showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...');
        $('#offcanvas-left, #offcanvas-right').removeClass('show');

        $.getJSON(`/api/chats/${chatId}`, function (chat) {
            console.log(chat)
            const item = chat.content;
            const box = $('#chat-box');
            box.empty();
            item.forEach(item => {
                if (item.role === 'user') appendMessage('user', item.text);
                if (item.role === 'assistant') appendMessage('assistant', item.text, item.ms_uuid);
            });

            currentChatId = chatId;
            hideLoader();
        }).fail(() => {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞');
            hideLoader();
        });
    }

    function uploadFiles(files) {
        if (files.length === 0) return;

        showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...');
        const formData = new FormData();

        for (let i = 0; i < files.length; i++) {
            formData.append('files', files[i]);
        }

        $.ajax({
            url: '/api/files',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                if (response._success) {
                    loadFiles();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + (response.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã'));
                }
                hideLoader();
            },
            error: function () {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ');
                hideLoader();
            }
        });
    }

    $(document).ready(function () {
        loadChatHistory();
        loadFiles();

        $('#upload-file-btn').click(() => $('#file-upload-input').click());

        $('#file-upload-input').on('change', function () {
            const files = Array.from(this.files);
            if (files.length > 0) {
                uploadFiles(files);
                $(this).val('');
            }
        });

        $('#send-btn').click(async function () {
            const prompt = $('#prompt-input').val().trim();
            if (!prompt) return alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');

            let ms_uuid = generateUUID();

            appendMessage('user', prompt);
            showLoader('–î—É–º–∞—é...');

            try {
                const response = await fetch('/api/response', {
                    method: 'POST',
                    body: JSON.stringify({
                        prompt: prompt,
                        chat_id: currentChatId,
                        ms_uuid: ms_uuid
                    })
                });

                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                if (!response.body) throw new Error('–ü–æ—Ç–æ–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let assistantMessage = '';

                while (true) {
                    const {done, value} = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, {stream: true});
                    const parsedData = JSON.parse(chunk);

                    console.log('chunk:', parsedData);
                    assistantMessage += parsedData.text;
                    currentChatId = parsedData.chat_id;

                    $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
                    $('#prompt-input').val('');
                }
                appendMessage('assistant', assistantMessage, ms_uuid);


            } catch (error) {
                appendMessage('assistant', `–û—à–∏–±–∫–∞: ${error.message}`);
            } finally {
                hideLoader();
                loadChatHistory();
            }
        });


        $('#new-chat').click(function () {
            $('#attached-files').empty();
            $('#chat-box').html('<div class="text-gray-400 text-sm text-center">–ù–æ–≤—ã–π —á–∞—Ç</div>');
            currentChatId = null;
            loadFiles();
        });
    });

    let redirectMessageId = null; // –≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω–∏—Ç ID —Å–æ–æ–±—â–µ–Ω–∏—è

    function openRedirectModal(id) {
        redirectMessageId = id;
        $('#redirect-filename').val(''); // –æ—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
        $('#redirect-modal').removeClass('hidden');
        $('#redirect-filename').focus();
    }

    function closeRedirectModal() {
        $('#redirect-modal').addClass('hidden');
        redirectMessageId = null;
    }

    function confirmRedirect() {
        const filename = $('#redirect-filename').val().trim();
        if (!filename) {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞');
            return;
        }
        $('#redirect-modal').addClass('hidden');

        // –≤—ã–∑—ã–≤–∞–µ–º redirectMessage —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞
        redirectMessage(redirectMessageId, filename);
        redirectMessageId = null;
    }
</script>

</body>
</html>
